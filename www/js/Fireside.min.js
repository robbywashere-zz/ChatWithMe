/*! Fireside - v0.1.0 - 2013-09-17
* http://www.github.com/robbywashere/fireside
* Copyright (c) 2013 Robby; Licensed MIT */
this.JSON||(this.JSON={}),function(){function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)d=rep[c],"string"==typeof d&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,!b||"function"==typeof b||"object"==typeof b&&"number"==typeof b.length)return str("",{"":a});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(){function a(){try{return h in f&&f[h]}catch(a){return!1}}function b(a){return function(){var b=Array.prototype.slice.call(arguments,0);b.unshift(d),j.appendChild(d),d.addBehavior("#default#userData"),d.load(h);var c=a.apply(e,b);return j.removeChild(d),c}}function c(a){return a.replace(m,"___")}var d,e={},f=window,g=f.document,h="localStorage",i="__storejs__";if(e.disabled=!1,e.set=function(){},e.get=function(){},e.remove=function(){},e.clear=function(){},e.transact=function(a,b,c){var d=e.get(a);null==c&&(c=b,b=null),"undefined"==typeof d&&(d=b||{}),c(d),e.set(a,d)},e.getAll=function(){},e.serialize=function(a){return JSON.stringify(a)},e.deserialize=function(a){if("string"!=typeof a)return void 0;try{return JSON.parse(a)}catch(b){return a||void 0}},a())d=f[h],e.set=function(a,b){return void 0===b?e.remove(a):(d.setItem(a,e.serialize(b)),b)},e.get=function(a){return e.deserialize(d.getItem(a))},e.remove=function(a){d.removeItem(a)},e.clear=function(){d.clear()},e.getAll=function(){for(var a={},b=0;b<d.length;++b){var c=d.key(b);a[c]=e.get(c)}return a};else if(g.documentElement.addBehavior){var j,k;try{k=new ActiveXObject("htmlfile"),k.open(),k.write('<script>document.w=window</script><iframe src="/favicon.ico"></iframe>'),k.close(),j=k.w.frames[0].document,d=j.createElement("div")}catch(l){d=g.createElement("div"),j=g.body}var m=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");e.set=b(function(a,b,d){return b=c(b),void 0===d?e.remove(b):(a.setAttribute(b,e.serialize(d)),a.save(h),d)}),e.get=b(function(a,b){return b=c(b),e.deserialize(a.getAttribute(b))}),e.remove=b(function(a,b){b=c(b),a.removeAttribute(b),a.save(h)}),e.clear=b(function(a){var b=a.XMLDocument.documentElement.attributes;a.load(h);for(var c,d=0;c=b[d];d++)a.removeAttribute(c.name);a.save(h)}),e.getAll=b(function(a){for(var b,d=a.XMLDocument.documentElement.attributes,f={},g=0;b=d[g];++g){var h=c(b.name);f[b.name]=e.deserialize(a.getAttribute(h))}return f})}try{e.set(i,i),e.get(i)!=i&&(e.disabled=!0),e.remove(i)}catch(l){e.disabled=!0}e.enabled=!e.disabled,"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(e):this.store=e}();var Base64=function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b={encode:function(b){var c,d,e,f,g,h,i,j="",k=0;do c=b.charCodeAt(k++),d=b.charCodeAt(k++),e=b.charCodeAt(k++),f=c>>2,g=(3&c)<<4|d>>4,h=(15&d)<<2|e>>6,i=63&e,isNaN(d)?h=i=64:isNaN(e)&&(i=64),j=j+a.charAt(f)+a.charAt(g)+a.charAt(h)+a.charAt(i);while(k<b.length);return j},decode:function(b){var c,d,e,f,g,h,i,j="",k=0;b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),h=a.indexOf(b.charAt(k++)),i=a.indexOf(b.charAt(k++)),c=f<<2|g>>4,d=(15&g)<<4|h>>2,e=(3&h)<<6|i,j+=String.fromCharCode(c),64!=h&&(j+=String.fromCharCode(d)),64!=i&&(j+=String.fromCharCode(e));while(k<b.length);return j}};return b}(),MD5=function(){var a=0,b="",c=8,d=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c},e=function(a,b){return a<<b|a>>>32-b},f=function(a){for(var b=[],d=(1<<c)-1,e=0;e<a.length*c;e+=c)b[e>>5]|=(a.charCodeAt(e/c)&d)<<e%32;return b},g=function(a){for(var b="",d=(1<<c)-1,e=0;e<32*a.length;e+=c)b+=String.fromCharCode(a[e>>5]>>>e%32&d);return b},h=function(b){for(var c=a?"0123456789ABCDEF":"0123456789abcdef",d="",e=0;e<4*b.length;e++)d+=c.charAt(15&b[e>>2]>>8*(e%4)+4)+c.charAt(15&b[e>>2]>>8*(e%4));return d},i=function(a){for(var c,d,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f="",g=0;g<4*a.length;g+=3)for(c=(255&a[g>>2]>>8*(g%4))<<16|(255&a[g+1>>2]>>8*((g+1)%4))<<8|255&a[g+2>>2]>>8*((g+2)%4),d=0;4>d;d++)f+=8*g+6*d>32*a.length?b:e.charAt(63&c>>6*(3-d));return f},j=function(a,b,c,f,g,h){return d(e(d(d(b,a),d(f,h)),g),c)},k=function(a,b,c,d,e,f,g){return j(b&c|~b&d,a,b,e,f,g)},l=function(a,b,c,d,e,f,g){return j(b&d|c&~d,a,b,e,f,g)},m=function(a,b,c,d,e,f,g){return j(b^c^d,a,b,e,f,g)},n=function(a,b,c,d,e,f,g){return j(c^(b|~d),a,b,e,f,g)},o=function(a,b){a[b>>5]|=128<<b%32,a[(b+64>>>9<<4)+14]=b;for(var c,e,f,g,h=1732584193,i=-271733879,j=-1732584194,o=271733878,p=0;p<a.length;p+=16)c=h,e=i,f=j,g=o,h=k(h,i,j,o,a[p+0],7,-680876936),o=k(o,h,i,j,a[p+1],12,-389564586),j=k(j,o,h,i,a[p+2],17,606105819),i=k(i,j,o,h,a[p+3],22,-1044525330),h=k(h,i,j,o,a[p+4],7,-176418897),o=k(o,h,i,j,a[p+5],12,1200080426),j=k(j,o,h,i,a[p+6],17,-1473231341),i=k(i,j,o,h,a[p+7],22,-45705983),h=k(h,i,j,o,a[p+8],7,1770035416),o=k(o,h,i,j,a[p+9],12,-1958414417),j=k(j,o,h,i,a[p+10],17,-42063),i=k(i,j,o,h,a[p+11],22,-1990404162),h=k(h,i,j,o,a[p+12],7,1804603682),o=k(o,h,i,j,a[p+13],12,-40341101),j=k(j,o,h,i,a[p+14],17,-1502002290),i=k(i,j,o,h,a[p+15],22,1236535329),h=l(h,i,j,o,a[p+1],5,-165796510),o=l(o,h,i,j,a[p+6],9,-1069501632),j=l(j,o,h,i,a[p+11],14,643717713),i=l(i,j,o,h,a[p+0],20,-373897302),h=l(h,i,j,o,a[p+5],5,-701558691),o=l(o,h,i,j,a[p+10],9,38016083),j=l(j,o,h,i,a[p+15],14,-660478335),i=l(i,j,o,h,a[p+4],20,-405537848),h=l(h,i,j,o,a[p+9],5,568446438),o=l(o,h,i,j,a[p+14],9,-1019803690),j=l(j,o,h,i,a[p+3],14,-187363961),i=l(i,j,o,h,a[p+8],20,1163531501),h=l(h,i,j,o,a[p+13],5,-1444681467),o=l(o,h,i,j,a[p+2],9,-51403784),j=l(j,o,h,i,a[p+7],14,1735328473),i=l(i,j,o,h,a[p+12],20,-1926607734),h=m(h,i,j,o,a[p+5],4,-378558),o=m(o,h,i,j,a[p+8],11,-2022574463),j=m(j,o,h,i,a[p+11],16,1839030562),i=m(i,j,o,h,a[p+14],23,-35309556),h=m(h,i,j,o,a[p+1],4,-1530992060),o=m(o,h,i,j,a[p+4],11,1272893353),j=m(j,o,h,i,a[p+7],16,-155497632),i=m(i,j,o,h,a[p+10],23,-1094730640),h=m(h,i,j,o,a[p+13],4,681279174),o=m(o,h,i,j,a[p+0],11,-358537222),j=m(j,o,h,i,a[p+3],16,-722521979),i=m(i,j,o,h,a[p+6],23,76029189),h=m(h,i,j,o,a[p+9],4,-640364487),o=m(o,h,i,j,a[p+12],11,-421815835),j=m(j,o,h,i,a[p+15],16,530742520),i=m(i,j,o,h,a[p+2],23,-995338651),h=n(h,i,j,o,a[p+0],6,-198630844),o=n(o,h,i,j,a[p+7],10,1126891415),j=n(j,o,h,i,a[p+14],15,-1416354905),i=n(i,j,o,h,a[p+5],21,-57434055),h=n(h,i,j,o,a[p+12],6,1700485571),o=n(o,h,i,j,a[p+3],10,-1894986606),j=n(j,o,h,i,a[p+10],15,-1051523),i=n(i,j,o,h,a[p+1],21,-2054922799),h=n(h,i,j,o,a[p+8],6,1873313359),o=n(o,h,i,j,a[p+15],10,-30611744),j=n(j,o,h,i,a[p+6],15,-1560198380),i=n(i,j,o,h,a[p+13],21,1309151649),h=n(h,i,j,o,a[p+4],6,-145523070),o=n(o,h,i,j,a[p+11],10,-1120210379),j=n(j,o,h,i,a[p+2],15,718787259),i=n(i,j,o,h,a[p+9],21,-343485551),h=d(h,c),i=d(i,e),j=d(j,f),o=d(o,g);return[h,i,j,o]},p=function(a,b){var d=f(a);d.length>16&&(d=o(d,a.length*c));for(var e=new Array(16),g=new Array(16),h=0;16>h;h++)e[h]=909522486^d[h],g[h]=1549556828^d[h];var i=o(e.concat(f(b)),512+b.length*c);return o(g.concat(i),640)},q={hexdigest:function(a){return h(o(f(a),a.length*c))},b64digest:function(a){return i(o(f(a),a.length*c))},hash:function(a){return g(o(f(a),a.length*c))},hmac_hexdigest:function(a,b){return h(p(a,b))},hmac_b64digest:function(a,b){return i(p(a,b))},hmac_hash:function(a,b){return g(p(a,b))},test:function(){return"900150983cd24fb0d6963f7d28e17f72"===MD5.hexdigest("abc")}};return q}();Function.prototype.bind||(Function.prototype.bind=function(a){var b=this,c=Array.prototype.slice,d=Array.prototype.concat,e=c.call(arguments,1);return function(){return b.apply(a?a:this,d.call(e,c.call(arguments,0)))}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1}),function(a){function b(a,b){return new f.Builder(a,b)}function c(a){return new f.Builder("message",a)}function d(a){return new f.Builder("iq",a)}function e(a){return new f.Builder("presence",a)}var f;f={VERSION:"1.0.2",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas"},addNamespace:function(a,b){f.NS[a]=b},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,forEachChild:function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++)e=a.childNodes[d],e.nodeType!=f.ElementType.NORMAL||b&&!this.isTagEqual(e,b)||c(e)},isTagEqual:function(a,b){return a.tagName.toLowerCase()==b.toLowerCase()},_xmlGenerator:null,_makeGenerator:function(){var a;return void 0===document.implementation.createDocument?(a=this._getIEXmlDom(),a.appendChild(a.createElement("strophe"))):a=document.implementation.createDocument("jabber:client","strophe",null),a},xmlGenerator:function(){return f._xmlGenerator||(f._xmlGenerator=f._makeGenerator()),f._xmlGenerator},_getIEXmlDom:function(){for(var a=null,b=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],c=0;c<b.length&&null===a;c++)try{a=new ActiveXObject(b[c])}catch(d){a=null}return a},xmlElement:function(a){if(!a)return null;var b,c,d,e=f.xmlGenerator().createElement(a);for(b=1;b<arguments.length;b++)if(arguments[b])if("string"==typeof arguments[b]||"number"==typeof arguments[b])e.appendChild(f.xmlTextNode(arguments[b]));else if("object"==typeof arguments[b]&&"function"==typeof arguments[b].sort)for(c=0;c<arguments[b].length;c++)"object"==typeof arguments[b][c]&&"function"==typeof arguments[b][c].sort&&e.setAttribute(arguments[b][c][0],arguments[b][c][1]);else if("object"==typeof arguments[b])for(d in arguments[b])arguments[b].hasOwnProperty(d)&&e.setAttribute(d,arguments[b][d]);return e},xmlescape:function(a){return a=a.replace(/\&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/'/g,"&apos;"),a=a.replace(/"/g,"&quot;")},xmlTextNode:function(a){return a=f.xmlescape(a),f.xmlGenerator().createTextNode(a)},getText:function(a){if(!a)return null;var b="";0===a.childNodes.length&&a.nodeType==f.ElementType.TEXT&&(b+=a.nodeValue);for(var c=0;c<a.childNodes.length;c++)a.childNodes[c].nodeType==f.ElementType.TEXT&&(b+=a.childNodes[c].nodeValue);return b},copyElement:function(a){var b,c;if(a.nodeType==f.ElementType.NORMAL){for(c=f.xmlElement(a.tagName),b=0;b<a.attributes.length;b++)c.setAttribute(a.attributes[b].nodeName.toLowerCase(),a.attributes[b].value);for(b=0;b<a.childNodes.length;b++)c.appendChild(f.copyElement(a.childNodes[b]))}else a.nodeType==f.ElementType.TEXT&&(c=f.xmlGenerator().createTextNode(a.nodeValue));return c},escapeNode:function(a){return a.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(a){return a.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(a){return a.indexOf("@")<0?null:a.split("@")[0]},getDomainFromJid:function(a){var b=f.getBareJidFromJid(a);if(b.indexOf("@")<0)return b;var c=b.split("@");return c.splice(0,1),c.join("@")},getResourceFromJid:function(a){var b=a.split("/");return b.length<2?null:(b.splice(0,1),b.join("/"))},getBareJidFromJid:function(a){return a?a.split("/")[0]:null},log:function(){},debug:function(a){this.log(this.LogLevel.DEBUG,a)},info:function(a){this.log(this.LogLevel.INFO,a)},warn:function(a){this.log(this.LogLevel.WARN,a)},error:function(a){this.log(this.LogLevel.ERROR,a)},fatal:function(a){this.log(this.LogLevel.FATAL,a)},serialize:function(a){var b;if(!a)return null;"function"==typeof a.tree&&(a=a.tree());var c,d,e=a.nodeName;for(a.getAttribute("_realname")&&(e=a.getAttribute("_realname")),b="<"+e,c=0;c<a.attributes.length;c++)"_realname"!=a.attributes[c].nodeName&&(b+=" "+a.attributes[c].nodeName.toLowerCase()+"='"+a.attributes[c].value.replace(/&/g,"&amp;").replace(/\'/g,"&apos;").replace(/</g,"&lt;")+"'");if(a.childNodes.length>0){for(b+=">",c=0;c<a.childNodes.length;c++)switch(d=a.childNodes[c],d.nodeType){case f.ElementType.NORMAL:b+=f.serialize(d);break;case f.ElementType.TEXT:b+=f.xmlescape(d.nodeValue);break;case f.ElementType.CDATA:b+="<![CDATA["+d.nodeValue+"]]>"}b+="</"+e+">"}else b+="/>";return b},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(a,b){f._connectionPlugins[a]=b}},f.Builder=function(a,b){("presence"==a||"message"==a||"iq"==a)&&(b&&!b.xmlns?b.xmlns=f.NS.CLIENT:b||(b={xmlns:f.NS.CLIENT})),this.nodeTree=f.xmlElement(a,b),this.node=this.nodeTree},f.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return f.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},attrs:function(a){for(var b in a)a.hasOwnProperty(b)&&this.node.setAttribute(b,a[b]);return this},c:function(a,b,c){var d=f.xmlElement(a,b,c);return this.node.appendChild(d),c||(this.node=d),this},cnode:function(a){var b=f.xmlGenerator();try{var c=void 0!==b.importNode}catch(d){var c=!1}var e=c?b.importNode(a,!0):f.copyElement(a);return this.node.appendChild(e),this.node=e,this},t:function(a){var b=f.xmlTextNode(a);return this.node.appendChild(b),this}},f.Handler=function(a,b,c,d,e,g,h){this.handler=a,this.ns=b,this.name=c,this.type=d,this.id=e,this.options=h||{matchbare:!1},this.options.matchBare||(this.options.matchBare=!1),this.from=this.options.matchBare?g?f.getBareJidFromJid(g):null:g,this.user=!0},f.Handler.prototype={isMatch:function(a){var b,c=null;if(c=this.options.matchBare?f.getBareJidFromJid(a.getAttribute("from")):a.getAttribute("from"),b=!1,this.ns){var d=this;f.forEachChild(a,null,function(a){a.getAttribute("xmlns")==d.ns&&(b=!0)}),b=b||a.getAttribute("xmlns")==this.ns}else b=!0;return!b||this.name&&!f.isTagEqual(a,this.name)||this.type&&a.getAttribute("type")!=this.type||this.id&&a.getAttribute("id")!=this.id||this.from&&c!=this.from?!1:!0},run:function(a){var b=null;try{b=this.handler(a)}catch(c){throw c.sourceURL?f.fatal("error: "+this.handler+" "+c.sourceURL+":"+c.line+" - "+c.name+": "+c.message):c.fileName?("undefined"!=typeof console&&(console.trace(),console.error(this.handler," - error - ",c,c.message)),f.fatal("error: "+this.handler+" "+c.fileName+":"+c.lineNumber+" - "+c.name+": "+c.message)):f.fatal("error: "+this.handler),c}return b},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},f.TimedHandler=function(a,b){this.period=a,this.handler=b,this.lastCalled=(new Date).getTime(),this.user=!0},f.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},f.Request=function(a,b,c,d){this.id=++f._requestId,this.xmlData=a,this.data=f.serialize(a),this.origFunc=b,this.func=b,this.rid=c,this.date=0/0,this.sends=d||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;var a=new Date;return(a-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;var a=new Date;return(a-this.dead)/1e3},this.xhr=this._newXHR()},f.Request.prototype={getResponse:function(){var a=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(a=this.xhr.responseXML.documentElement,"parsererror"==a.tagName)throw f.error("invalid response received"),f.error("responseText: "+this.xhr.responseText),f.error("responseXML: "+f.serialize(this.xhr.responseXML)),"parsererror"}else this.xhr.responseText&&(f.error("invalid response received"),f.error("responseText: "+this.xhr.responseText),f.error("responseXML: "+f.serialize(this.xhr.responseXML)));return a},_newXHR:function(){var a=null;return window.XMLHttpRequest?(a=new XMLHttpRequest,a.overrideMimeType&&a.overrideMimeType("text/xml")):window.ActiveXObject&&(a=new ActiveXObject("Microsoft.XMLHTTP")),a.onreadystatechange=this.func.bind(null,this),a}},f.Connection=function(a){this.service=a,this.jid="",this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.streamId=null,this.features=null,this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this.paused=!1,this.hold=1,this.wait=60,this.window=5,this._data=[],this._requests=[],this._uniqueId=Math.round(1e4*Math.random()),this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this._idleTimeout=setTimeout(this._onIdle.bind(this),100);for(var b in f._connectionPlugins)if(f._connectionPlugins.hasOwnProperty(b)){var c=f._connectionPlugins[b],d=function(){};d.prototype=c,this[b]=new d,this[b].init(this)}},f.Connection.prototype={reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.streamId=null,this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this._requests=[],this._uniqueId=Math.round(1e4*Math.random())},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(a){return"string"==typeof a||"number"==typeof a?++this._uniqueId+":"+a:++this._uniqueId+""},connect:function(a,b,c,d,e){this.jid=a,this.pass=b,this.connect_callback=c,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.errors=0,this.wait=d||this.wait,this.hold=e||this.hold,this.domain=f.getDomainFromJid(this.jid);var g=this._buildBody().attrs({to:this.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":f.NS.BOSH});this._changeConnectStatus(f.Status.CONNECTING,null),this._requests.push(new f.Request(g.tree(),this._onRequestStateChange.bind(this,this._connect_cb.bind(this)),g.tree().getAttribute("rid"))),this._throttledRequestHandler()},attach:function(a,b,c,d,e,g,h){this.jid=a,this.sid=b,this.rid=c,this.connect_callback=d,this.domain=f.getDomainFromJid(this.jid),this.authenticated=!0,this.connected=!0,this.wait=e||this.wait,this.hold=g||this.hold,this.window=h||this.window,this._changeConnectStatus(f.Status.ATTACHED,null)},xmlInput:function(){},xmlOutput:function(){},rawInput:function(){},rawOutput:function(){},send:function(a){if(null!==a){var b={};if("function"==typeof a.sort)for(var c=0;c<a.length;c++)this._queueData(a[c],b);else"function"==typeof a.tree?this._queueData(a.tree(),b):this._queueData(a,b);return this._throttledRequestHandler(),clearTimeout(this._idleTimeout),this._idleTimeout=setTimeout(this._onIdle.bind(this),100),{success:function(a){return b.success=a,this},error:function(a){return b.error=a,this}}}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendIQ:function(a,b,c,d){var e=null,f=this;"function"==typeof a.tree&&(a=a.tree());var g=a.getAttribute("id");g||(g=this.getUniqueId("sendIQ"),a.setAttribute("id",g));var h=this.addHandler(function(a){e&&f.deleteTimedHandler(e);var d=a.getAttribute("type");if("result"==d)b&&b(a);else{if("error"!=d)throw{name:"StropheError",message:"Got bad IQ type of "+d};c&&c(a)}},null,"iq",null,g);return d&&(e=this.addTimedHandler(d,function(){return f.deleteHandler(h),c&&c(null),!1})),this.send(a),g},_queueData:function(a,b){if(null===a||!a.tagName||!a.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};a.callbacks=b,this._data.push(a)},_sendRestart:function(){this._data.push("restart"),this._throttledRequestHandler(),clearTimeout(this._idleTimeout),this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},addTimedHandler:function(a,b){var c=new f.TimedHandler(a,b);return this.addTimeds.push(c),c},deleteTimedHandler:function(a){this.removeTimeds.push(a)},addHandler:function(a,b,c,d,e,g,h){var i=new f.Handler(a,b,c,d,e,g,h);return this.addHandlers.push(i),i},deleteHandler:function(a){this.removeHandlers.push(a)},disconnect:function(a){this._changeConnectStatus(f.Status.DISCONNECTING,a),f.info("Disconnect was called because: "+a),this.connected&&(this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._sendTerminate())},_changeConnectStatus:function(a,b){for(var c in f._connectionPlugins)if(f._connectionPlugins.hasOwnProperty(c)){var d=this[c];if(d.statusChanged)try{d.statusChanged(a,b)}catch(e){f.error(""+c+" plugin caused an exception "+"changing status: "+e)}}if(this.connect_callback)try{this.connect_callback(a,b)}catch(g){f.error("User connection callback caused an exception: "+g)}},_buildBody:function(){var a=b("body",{rid:this.rid++,xmlns:f.NS.HTTPBIND});return null!==this.sid&&a.attrs({sid:this.sid}),a},_removeRequest:function(a){f.debug("removing request");var b;for(b=this._requests.length-1;b>=0;b--)a==this._requests[b]&&this._requests.splice(b,1);a.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(a){var b=this._requests[a];null===b.dead&&(b.dead=new Date),this._processRequest(a)},_processRequest:function(a){var b=this._requests[a],c=-1;try{4==b.xhr.readyState&&(c=b.xhr.status)}catch(d){f.error("caught an error in _requests["+a+"], reqStatus: "+c)}if("undefined"==typeof c&&(c=-1),b.sends>5)return this._onDisconnectTimeout(),void 0;var e=b.age(),g=!isNaN(e)&&e>Math.floor(f.TIMEOUT*this.wait),h=null!==b.dead&&b.timeDead()>Math.floor(f.SECONDARY_TIMEOUT*this.wait),i=4==b.xhr.readyState&&(1>c||c>=500);if((g||h||i)&&(h&&f.error("Request "+this._requests[a].id+" timed out (secondary), restarting"),b.abort=!0,b.xhr.abort(),b.xhr.onreadystatechange=function(){},this._requests[a]=new f.Request(b.xmlData,b.origFunc,b.rid,b.sends),b=this._requests[a]),0===b.xhr.readyState){f.debug("request id "+b.id+"."+b.sends+" posting");try{b.xhr.open("POST",this.service,!0)}catch(j){return f.error("XHR open failed."),this.connected||this._changeConnectStatus(f.Status.CONNFAIL,"bad-service"),this.disconnect(),void 0}var k=function(){b.date=new Date,b.xhr.send(b.data)};if(b.sends>1){var l=1e3*Math.min(Math.floor(f.TIMEOUT*this.wait),Math.pow(b.sends,3));setTimeout(k,l)}else k();b.sends++,this.xmlOutput!==f.Connection.prototype.xmlOutput&&this.xmlOutput(b.xmlData),this.rawOutput!==f.Connection.prototype.rawOutput&&this.rawOutput(b.data)}else f.debug("_processRequest: "+(0===a?"first":"second")+" request has readyState of "+b.xhr.readyState)},_throttledRequestHandler:function(){this._requests?f.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):f.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))},_onRequestStateChange:function(a,b){if(f.debug("request id "+b.id+"."+b.sends+" state changed to "+b.xhr.readyState),b.abort)return b.abort=!1,void 0;var c;if(4==b.xhr.readyState){c=0;try{c=b.xhr.status}catch(d){}if("undefined"==typeof c&&(c=0),this.disconnecting&&c>=400)return this._hitError(c),void 0;var e=this._requests[0]==b,g=this._requests[1]==b;(c>0&&500>c||b.sends>5)&&(this._removeRequest(b),f.debug("request id "+b.id+" should now be removed")),200==c?((g||e&&this._requests.length>0&&this._requests[0].age()>Math.floor(f.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),f.debug("request id "+b.id+"."+b.sends+" got 200"),a(b),this.errors=0):(this._execCBStack(this._callbackStack,!1),f.error("request id "+b.id+"."+b.sends+" error "+c+" happened"),(0===c||c>=400&&600>c||c>=12e3)&&(this._hitError(c),c>=400&&500>c&&(this._changeConnectStatus(f.Status.DISCONNECTING,null),this._doDisconnect()))),c>0&&500>c||b.sends>5||this._throttledRequestHandler()}},_hitError:function(a){this.errors++,f.warn("request errored, status: "+a+", number of errors: "+this.errors),this.errors>4&&this._onDisconnectTimeout()},_doDisconnect:function(){f.info("_doDisconnect was called"),this.authenticated=!1,this.disconnecting=!1,this.sid=null,this.streamId=null,this.rid=Math.floor(4294967295*Math.random()),this.connected&&(this._changeConnectStatus(f.Status.DISCONNECTED,null),this.connected=!1),this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[]},_execCBStack:function(a,b){if("object"==typeof a){var c=b?"success":"error";for(a.reverse();a.length>0;){var d=a.pop();d.hasOwnProperty(c)&&"function"==typeof d[c]&&d[c](),d=null}}},_dataRecv:function(a){try{var b=a.getResponse()}catch(c){if("parsererror"!=c)throw c;this.disconnect("strophe-parsererror")}if(null!==b){this.xmlInput!==f.Connection.prototype.xmlInput&&this.xmlInput(b),this.rawInput!==f.Connection.prototype.rawInput&&this.rawInput(f.serialize(b));for(var d,e;this.removeHandlers.length>0;)e=this.removeHandlers.pop(),d=this.handlers.indexOf(e),d>=0&&this.handlers.splice(d,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&0===this._requests.length)return this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null,this._doDisconnect(),void 0;var g,h,i=b.getAttribute("type");if(null!==i&&"terminate"==i){if(this._execCBStack(this._callbackStack,!1),this.disconnecting)return;return g=b.getAttribute("condition"),h=b.getElementsByTagName("conflict"),null!==g?("remote-stream-error"==g&&h.length>0&&(g="conflict"),this._changeConnectStatus(f.Status.CONNFAIL,g)):this._changeConnectStatus(f.Status.CONNFAIL,"unknown"),this.disconnect(),void 0}this._execCBStack(this._callbackStack,!0);var j=this;f.forEachChild(b,null,function(a){var b,c;for(c=j.handlers,j.handlers=[],b=0;b<c.length;b++){var d=c[b];try{!d.isMatch(a)||!j.authenticated&&d.user?j.handlers.push(d):d.run(a)&&j.handlers.push(d)}catch(e){}}})}},_sendTerminate:function(){f.info("_sendTerminate was called");var a=this._buildBody().attrs({type:"terminate"});this.authenticated&&a.c("presence",{xmlns:f.NS.CLIENT,type:"unavailable"}),this.disconnecting=!0;var b=new f.Request(a.tree(),this._onRequestStateChange.bind(this,this._dataRecv.bind(this)),a.tree().getAttribute("rid"));this._requests.push(b),this._throttledRequestHandler()},_connect_cb:function(a){f.info("_connect_cb was called"),this.connected=!0;var c=a.getResponse();if(c){this.xmlInput!==f.Connection.prototype.xmlInput&&this.xmlInput(c),this.rawInput!==f.Connection.prototype.rawInput&&this.rawInput(f.serialize(c));var e,g,h=c.getAttribute("type");if(null!==h&&"terminate"==h)return e=c.getAttribute("condition"),g=c.getElementsByTagName("conflict"),null!==e?("remote-stream-error"==e&&g.length>0&&(e="conflict"),this._changeConnectStatus(f.Status.CONNFAIL,e)):this._changeConnectStatus(f.Status.CONNFAIL,"unknown"),void 0;this.sid||(this.sid=c.getAttribute("sid")),this.stream_id||(this.stream_id=c.getAttribute("authid"));var i=c.getAttribute("requests");i&&(this.window=parseInt(i,10));var j=c.getAttribute("hold");j&&(this.hold=parseInt(j,10));var k=c.getAttribute("wait");k&&(this.wait=parseInt(k,10));var l,m,n,o,p=!1,q=!1,r=!1,s=c.getElementsByTagName("mechanism");if(!(s.length>0)){var t=this._buildBody();return this._requests.push(new f.Request(t.tree(),this._onRequestStateChange.bind(this,this._connect_cb.bind(this)),t.tree().getAttribute("rid"))),this._throttledRequestHandler(),void 0}for(l=0;l<s.length;l++)m=f.getText(s[l]),"DIGEST-MD5"==m?q=!0:"PLAIN"==m?p=!0:"ANONYMOUS"==m&&(r=!0);null===f.getNodeFromJid(this.jid)&&r?(this._changeConnectStatus(f.Status.AUTHENTICATING,null),this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this.send(b("auth",{xmlns:f.NS.SASL,mechanism:"ANONYMOUS"}).tree())):null===f.getNodeFromJid(this.jid)?(this._changeConnectStatus(f.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect()):q?(this._changeConnectStatus(f.Status.AUTHENTICATING,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge1_cb.bind(this),null,"challenge",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this.send(b("auth",{xmlns:f.NS.SASL,mechanism:"DIGEST-MD5"}).tree())):p?(n=f.getBareJidFromJid(this.jid),n+="\x00",n+=f.getNodeFromJid(this.jid),n+="\x00",n+=this.pass,this._changeConnectStatus(f.Status.AUTHENTICATING,null),this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),o=Base64.encode(n),this.send(b("auth",{xmlns:f.NS.SASL,mechanism:"PLAIN"}).t(o).tree())):(this._changeConnectStatus(f.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(d({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:f.NS.AUTH}).c("username",{}).t(f.getNodeFromJid(this.jid)).tree()))
}},_sasl_challenge1_cb:function(a){var c,d=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,e=Base64.decode(f.getText(a)),g=MD5.hexdigest(""+1234567890*Math.random()),h="",i=null,j="",k="";for(this.deleteHandler(this._sasl_failure_handler);e.match(d);)switch(c=e.match(d),e=e.replace(c[0],""),c[2]=c[2].replace(/^"(.+)"$/,"$1"),c[1]){case"realm":h=c[2];break;case"nonce":j=c[2];break;case"qop":k=c[2];break;case"host":i=c[2]}var l="xmpp/"+this.domain;null!==i&&(l=l+"/"+i);var m=MD5.hash(f.getNodeFromJid(this.jid)+":"+h+":"+this.pass)+":"+j+":"+g,n="AUTHENTICATE:"+l,o="";return o+="username="+this._quote(f.getNodeFromJid(this.jid))+",",o+="realm="+this._quote(h)+",",o+="nonce="+this._quote(j)+",",o+="cnonce="+this._quote(g)+",",o+='nc="00000001",',o+='qop="auth",',o+="digest-uri="+this._quote(l)+",",o+="response="+this._quote(MD5.hexdigest(MD5.hexdigest(m)+":"+j+":00000001:"+g+":auth:"+MD5.hexdigest(n)))+",",o+='charset="utf-8"',this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge2_cb.bind(this),null,"challenge",null,null),this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this.send(b("response",{xmlns:f.NS.SASL}).t(Base64.encode(o)).tree()),!1},_quote:function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},_sasl_challenge2_cb:function(){return this.deleteHandler(this._sasl_success_handler),this.deleteHandler(this._sasl_failure_handler),this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this.send(b("response",{xmlns:f.NS.SASL}).tree()),!1},_auth1_cb:function(){var a=d({type:"set",id:"_auth_2"}).c("query",{xmlns:f.NS.AUTH}).c("username",{}).t(f.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return f.getResourceFromJid(this.jid)||(this.jid=f.getBareJidFromJid(this.jid)+"/strophe"),a.up().c("resource",{}).t(f.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(a.tree()),!1},_sasl_success_cb:function(){return f.info("SASL authentication succeeded."),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._addSysHandler(this._sasl_auth1_cb.bind(this),null,"stream:features",null,null),this._sendRestart(),!1},_sasl_auth1_cb:function(a){this.features=a;var b,c;for(b=0;b<a.childNodes.length;b++)c=a.childNodes[b],"bind"==c.nodeName&&(this.do_bind=!0),"session"==c.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(f.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var e=f.getResourceFromJid(this.jid);return e?this.send(d({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:f.NS.BIND}).c("resource",{}).t(e).tree()):this.send(d({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:f.NS.BIND}).tree()),!1},_sasl_bind_cb:function(a){if("error"==a.getAttribute("type"))return f.info("SASL binding failed."),this._changeConnectStatus(f.Status.AUTHFAIL,null),!1;var b,c=a.getElementsByTagName("bind");return c.length>0?(b=c[0].getElementsByTagName("jid"),b.length>0&&(this.jid=f.getText(b[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(d({type:"set",id:"_session_auth_2"}).c("session",{xmlns:f.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(f.Status.CONNECTED,null))),void 0):(f.info("SASL binding failed."),this._changeConnectStatus(f.Status.AUTHFAIL,null),!1)},_sasl_session_cb:function(a){if("result"==a.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(f.Status.CONNECTED,null);else if("error"==a.getAttribute("type"))return f.info("Session creation failed."),this._changeConnectStatus(f.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._changeConnectStatus(f.Status.AUTHFAIL,null),!1},_auth2_cb:function(a){return"result"==a.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(f.Status.CONNECTED,null)):"error"==a.getAttribute("type")&&(this._changeConnectStatus(f.Status.AUTHFAIL,null),this.disconnect()),!1},_addSysTimedHandler:function(a,b){var c=new f.TimedHandler(a,b);return c.user=!1,this.addTimeds.push(c),c},_addSysHandler:function(a,b,c,d,e){var g=new f.Handler(a,b,c,d,e);return g.user=!1,this.addHandlers.push(g),g},_onDisconnectTimeout:function(){f.info("_onDisconnectTimeout was called");for(var a;this._requests.length>0;)a=this._requests.pop(),a.abort=!0,a.xhr.abort(),a.xhr.onreadystatechange=function(){};return this._doDisconnect(),!1},_onIdle:function(){for(var a,b,c,d;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)b=this.removeTimeds.pop(),a=this.timedHandlers.indexOf(b),a>=0&&this.timedHandlers.splice(a,1);var e=(new Date).getTime();for(d=[],a=0;a<this.timedHandlers.length;a++)b=this.timedHandlers[a],(this.authenticated||!b.user)&&(c=b.lastCalled+b.period,0>=c-e?b.run()&&d.push(b):d.push(b));this.timedHandlers=d;var g,h,i=[];if(this.authenticated&&0===this._requests.length&&0===this._data.length&&!this.disconnecting&&(f.info("no requests during idle cycle, sending blank request"),this._data.push(null)),this._requests.length<2&&this._data.length>0&&!this.paused){for(g=this._buildBody(),a=0;a<this._data.length;a++)null!==this._data[a]&&("restart"===this._data[a]?g.attrs({to:this.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":f.NS.BOSH}):(g.cnode(this._data[a]).up(),i.push(this._data[a].callbacks),delete this._data[a].callbacks));delete this._data,this._data=[],this._callbackStack=i,this._requests.push(new f.Request(g.tree(),this._onRequestStateChange.bind(this,this._dataRecv.bind(this)),g.tree().getAttribute("rid"))),this._processRequest(this._requests.length-1)}this._requests.length>0&&(h=this._requests[0].age(),null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(f.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),h>Math.floor(f.TIMEOUT*this.wait)&&(f.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(f.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())),clearTimeout(this._idleTimeout),this.connected&&(this._idleTimeout=setTimeout(this._onIdle.bind(this),100))}},a&&a(f,b,c,d,e)}(function(){window.Strophe=arguments[0],window.$build=arguments[1],window.$msg=arguments[2],window.$iq=arguments[3],window.$pres=arguments[4]}),Fireside={},Fireside.util=function(){var a={throttle:function(b,c,d){var e=0,f=new a.timer(b,function(){e==c&&this.start(),e=0}),g=function(){return c>e&&f.status>-1?(e++,d.apply(this,arguments),f):f};return g.cancel=function(){return f.cancel(),this},g.start=function(){return f.start(),this},g},timer:function(a){var b=this,c=a;b._qu=b._qu||[],2==arguments.length&&(b._callback="function"==typeof arguments[1]?arguments[1]:!1),b.status=-1;var d,e=!1,f=function(){if(b.status=1,0==e&&b._callback&&b._callback(b),b._qu.length>0){b._qu.reverse();var a=b._qu.pop();b._qu.reverse(),d=a.ms,b._callback=a.cb,b.status=-1,b.start()}};return b.jump=function(){f()},b.reset=function(){return clearTimeout(d),b.status=-1,b},b.debounce=function(){return 0!==b.status?b:("function"==typeof arguments[0]&&(b._callback=arguments[0]),clearTimeout(d),b.status=-1,b.start(),b)},b.queue=function(a,d){if(1===b.status)return c=a,b._callback=d,b.status=-1,b.start(),b;var e={ms:a,cb:d};return b._qu.push(e),b},b.start=function(){return 0===b.status?b:(clearTimeout(d),d=setTimeout(f,c),b.status=0,b)},b.cancel=function(){return b.status=-1,clearTimeout(d),b},b},Jar:{set:function(a,b){var c=document.cookie;try{c=JSON.parse(c)}catch(d){c={}}finally{c[a]=b,0==b.length&&delete c[a],document.cookie=JSON.stringify(c)}},get:function(a){try{return _cookie=JSON.parse(document.cookie),_cookie[a]}catch(b){return null}}},assertKeys:function(a,b){var c=[];for(var d in b){var e=b[d];"undefined"==typeof a[e]&&c.push("<Key>:"+e)}return c.length>0?!1:!0}};return a}(window.jQuery),Fireside.logic=function(a){var b=!1,c=!1,d=!1;return Self={},Self.misc={supportName:function(a){var b=Self.socket.roster.support,c=b[a].pageAlias?b[a].pageAlias:b[a].name;return c},supportStatus:function(a,b){Self.misc.log("LOG",a+" changed status to..."+b),Self.hooks.statusChange(a,b)},trim:function(a){a=a.replace(/^\s+/,"");for(var b=a.length-1;b>=0;b--)if(/\S/.test(a.charAt(b))){a=a.substring(0,b+1);break}return a},addHook:function(a,b){var c=Self.hooks[a],d=function(){c.apply(this,arguments),b.apply(this,arguments)};Self.hooks[a]=d},random:function(){var a=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return a()+a()+"-"+a()+a()},log:function(a,c){"DEBUG"===a&&b===!0&&console.log(c),"LOG"===a&&d===!0&&console.log(c)},store:{set:store.set,get:store.get}},Self.control={init:function(a){this.socket=new Strophe.Connection(a.domain+a.bind),c===!0&&(Self.socket.rawInput=function(a){console.log(">>>",a)},Self.socket.rawOutput=function(a){console.log("<<<",a)}),Self.control.restoreUser()||Self.control.registerConnect(Self.control.createProfile)},registerConnect:function(a){Self.control.register(a).success(function(){Self.events.registerSuccess(a)})},restoreUser:function(){if(this.restoreProfile()){var a=this.restoreProfile();return Self.control.connect(a,Self.events.stropheStatus),!0}return!1},storeProfile:function(a){Self.misc.store.set("profile",a)},restoreProfile:function(){return"undefined"==typeof Self.misc.store.get("profile")?!1:Self.misc.store.get("profile")},createProfile:function(){var a={username:Self.misc.random(),password:Self.misc.random(),host:"undefined"!=typeof options.host?options.host:window.location.hostname};return a.jid=a.username+"@"+a.host,Self.misc.log("DEBUG","Created profile: "+JSON.stringify(a)),a},register:function(b){var c=a.post(options.domain+"/register",JSON.stringify({username:b.username,password:b.password,host:b.host}));return c},nickname:function(a){var b=function(){for(var b in Self.socket.roster.support)break;Self.socket.send($pres({from:Self.socket.jid,to:b}).c("nick",{xmlns:"http://jabber.org/protocol/nick"}).t(a))};if(Self.socket.connected)b();else{var c=Self.hooks.connected;Self.hooks.connected=function(){c(),b()}}},connect:function(a,b){Self.socket.connected&&Self.misc.log("DEBUG","Already Connected, Aborting..."),Self.misc.log("DEBUG","Connecting with:"+JSON.stringify(a)),Self.socket.connect(a.jid,a.password,b)},sendMsg:function(a){try{if(!Self.socket.connected)throw"Not connected ";if("undefined"==typeof Self.socket.roster.support)throw"Support contact not found"}catch(b){Self.misc.log("DEBUG",b);var c=function(a){return a&&a(),this},d=function(){};return{error:c,success:d}}for(var e in Self.socket.roster.support)break;var f=Strophe.getBareJidFromJid(Self.socket.jid),g=$build("message",{to:e,from:f,type:"chat"}).c("body").t(a).tree(),h=Self.socket.send(g);return Self.misc.log("DEBUG",g),h}},Self.events={init:function(){},stropheStatus:function(a){a==Strophe.Status.CONNECTING?(Self.misc.log("DEBUG","Connecting to server..."),Self.hooks.connecting()):a==Strophe.Status.CONNFAIL?Self.misc.log("DEBUG","Connection failed"):a==Strophe.Status.DISCONNECTING?Self.misc.log("DEBUG","Disconnecting..."):a==Strophe.Status.ATTACHED?Self.misc.log("DEBUG","Attached Session"):a==Strophe.Status.AUTHFAIL?(Self.misc.log("DEBUG","Auth failed"),Self.events.authFailed()):a==Strophe.Status.DISCONNECTED?(Self.misc.log("DEBUG","Disconnected from server"),Self.hooks.disconnected(),Self.events.disconnected()):a==Strophe.Status.CONNECTED&&(Self.misc.log("DEBUG","Connected to server"),Self.events.connected(),Self.hooks.connected())},authFailed:function(){Self.socket.disconnect(),this.disconnected=function(){Self.control.registerConnect(Self.control.createProfile()),this.disconnected=function(){}}},_onMsg:function(b){if(a(b).find("forwarded").length>0)var c=a(b).find("forwarded").last().children().get()[0];else var c=b;return msgObj={to:c.getAttribute("to"),from:Strophe.getBareJidFromJid(c.getAttribute("from")),type:c.getAttribute("type"),elems:c.getElementsByTagName("body")},msgObj.elems.length>0?(msgObj.body=Strophe.getText(msgObj.elems[0]),Self.events.messaged(msgObj)):msgObj.body="<undefined>",!0},presence:function(b){var c=a(b),d=Strophe.getBareJidFromJid(c.attr("from")),e=Self.socket.roster.support;if(e.hasOwnProperty(d)&&e[d].hasOwnProperty("name")){var f=e[d].pageAlias?e[d].pageAlias:e[d].name;if("unavailable"===c.attr("type"))Self.misc.supportStatus(f,"unavailable");else{var g=c.find("show").text();0==g.length&&(g="chat"),Self.misc.supportStatus(f,g)}}return!0},messaged:function(a){var b=a.from;try{var c=Self.misc.supportName(b)}catch(d){var c=b;Self.misc.log("DEBUG",c+" :error determining support name "+a.body)}Self.misc.log("DEBUG",c+" : "+a.body);try{Self.hooks.message(c,a.body)}catch(d){}return!0},roster:function(b){Self.misc.log("DEBUG",b);var c={};a(b).find("item").each(function(){var b=a(this),d=b.find("group").text()||"Unknown";c[d]={},c[d][b.attr("jid")]={jid:b.attr("jid"),name:b.attr("name"),pageAlias:"undefined"!=typeof options.supportAlias?options.supportAlias:null,subscription:b.attr("subscription")}}),Self.socket.roster=c},connected:function(){Self.socket.addHandler(Self.events._onMsg,null,"message",null,null,null),Self.socket.addHandler(Self.events.presence,null,"presence",null,null,null),Self.socket.sendIQ($iq({type:"get"}).c("query",{xmlns:"jabber:iq:roster"}),function(a){Self.events.roster(a)}),Self.socket.send($iq({type:"set",id:"enablecarbons"}).c("enable",{xmlns:"urn:xmpp:carbons:2"}).tree()),Self.socket.send($pres().tree())},registerSuccess:function(a){Self.misc.log("DEBUG","Registered as "+a.username),Self.control.storeProfile(a),Self.control.connect(a,this.stropheStatus)}},Self.hooks={message:function(){},statusChange:function(){},connected:function(){},disconnected:function(){},connecting:function(){}},Self.init=Self.control.init,Self}(window.jQuery),Fireside.ui=function(a){var b={isScrollBottom:function(){return b.DOM.log[0].scrollHeight-b.DOM.log.scrollTop()==b.DOM.log.outerHeight()},DOM:{},toggle:function(a){"boolean"==typeof a&&Fireside.logic.misc.store.set("abled",a);var b=Fireside.logic.misc.store.get("abled");Fireside.logic.misc.store.set("abled",!b),console.log(b),b?Fireside.logic.socket.connected||Fireside.logic.control.restoreUser():Fireside.logic.socket.connected&&Fireside.logic.socket.disconnect()},init:function(c){a("body").append(Fireside.template),a("html").append("<style>"+Fireside.css+"</style"),this.DOM.sentence_template=a('[data-attr="sentence"]'),this.DOM.info=a('[data-attr="info"]'),this.DOM.log=a('[data-attr="log"]'),this.DOM.titlebar=a('[data-attr="titlebar"]'),this.DOM["status-icon"]=a('[data-attr="status-icon"]'),this.DOM.textarea=a('[data-attr="textarea"]'),this.DOM["nickname-box"]=a('[data-attr="nickname-box"]'),this.DOM.nickname=a('[data-attr="nickname"]'),this.DOM.chatbox=a('[data-container="chatbox"]'),this.DOM["chatbox-title"]=a('[data-attr="chatbox-title"]'),this.DOM.title=a("title"),this.DOM["menu-button"]=a(".cwm-menu .menu-button"),this.DOM.menu=a(".cwm-menu-container"),this.DOM["menu-action"]=a(".cwm-menu [data-action]");var d=new Fireside.util.throttle(2e3,1,function(a){console.log(a)});this.DOM.log.scroll(function(){d("BLAH!").start()}),this.DOM["menu-button"].click(function(){return a(".cwm-menu-container").toggle(),!1}),this.DOM.menu.click(function(){a(this).hide()}),this.DOM["menu-action"].click(function(){var c=a(this).data("action");"clear"===c&&(Fireside.logic.misc.store.set("offlineLog",null),b.DOM.log.html("")),"disconnect"===c&&Fireside.logic.socket.disconnect(),"connect"===c&&Fireside.logic.control.restoreUser(),"toggle"===c&&b.toggle()}),c.supportAlias&&this.DOM.titlebar.append(c.supportAlias);var e=Fireside.logic.misc.store.get("chatbox-state")?!0:!1;e&&b.DOM.chatbox.removeClass("minimize"),this.DOM["chatbox-title"].click(function(){return e=!e,Fireside.logic.misc.store.set("chatbox-state",e),e?b.DOM.chatbox.removeClass("minimize"):(b.DOM.chatbox.addClass("minimize"),b.DOM.textarea.blur()),!1}),this.DOM.chatbox.click(function(){b.DOM.chatbox.find('input[type="text"]:visible, textarea:visible').first().focus(),b.notify(!1)}),this.DOM.textarea.focus(function(){}),a('[data-attr="sentence"]').remove(),null==Fireside.logic.misc.store.get("nickname")||null==Fireside.logic.misc.store.get("profile")?(this.DOM.nickname.bind("keydown",function(c){if(13===c.keyCode){var d=a(this).val();Fireside.logic.control.nickname(d),Fireside.logic.misc.store.set("nickname",d),b.DOM["nickname-box"].hide(),b.DOM.textarea.focus(),a(this).unbind("keydown"),Fireside.logic.control.registerConnect(Fireside.logic.control.createProfile());var e="Hello "+d+" ! Welcome :) ";return b.DOM.log.append(a("<em>"+e+"</em>")),!1}}),b.DOM["nickname-box"].show()):b.DOM["nickname-box"].hide(),a('[data-attr="textarea"]').keydown(function(c){if(13===c.keyCode&&!c.originalEvent.shiftKey){if(!Fireside.logic.socket.connected)return!1;var d=a(this).val(),e=b.logMsg("Me",d);if(e){var f=Fireside.logic.control.sendMsg(d);f.error(function(){var a=!0;e.log(a),e.el.addClass("error")}).success(function(){e.log(!1)})}return a(this).val(""),!1}}),Fireside.logic.hooks.disconnected=function(){b.userStatus("offline"),b.DOM.info.show().text("You are not connected")},Fireside.logic.hooks.connecting=function(){b.showConnecting()},Fireside.logic.hooks.message=function(a,c){a==Strophe.getBareJidFromJid(Fireside.logic.socket.jid)?(a="Me",b.logMsg(a,c)):(b.notify(!0),b.logMsg(a,c))},Fireside.logic.hooks.connected=function(){b.offLogRestore()},Fireside.logic.hooks.statusChange=function(a,c){var d={away:"away",chat:"online",dnd:"busy",xa:"away",unavailable:"offline"};"unavailable"==c?b.DOM.info.show().text(a+" is offline, but you may still send messages"):(null!=Fireside.logic.misc.store.get("nickname")&&Fireside.logic.control.nickname(Fireside.logic.misc.store.get("nickname")),b.DOM.info.hide().text("")),b.userStatus(d[c])}},showConnecting:function(){b.userStatus("connecting"),b.DOM.info.show().text("Connecting...");var a=Fireside.logic.hooks.connected;Fireside.logic.hooks.connected=function(){a(),b.DOM.info.hide().text("")}},notify:function(a){a&&!this.DOM.textarea.is(":focus")?b.titleAlert("New Message",!0):b.titleAlert(null,!1)},alternate:function(a,b){var c,d={};d.fn1=a,d.fn2=b;var e=[a,b],f=0;this.start=function(){return c=setInterval(function(){f++,f%=2,e[f]()},1e3),this},this.stop=function(){return clearInterval(c),"function"==typeof d.fn1&&d.fn1(),this}},titleAlert:function(){var a={};return a.stop=function(){},function(c,d){if(a.stop(),null!=c||d){var e=this.DOM.title.text(),f=c,g=this,h=function(){c&&g.DOM.title.text(e),b.DOM["chatbox-title"].removeClass("lightup")},i=function(){c&&g.DOM.title.text(f),b.DOM["chatbox-title"].addClass("lightup")};a=new this.alternate(h,i).start()}}}(),offLogSet:function(a,b,c){var d=25,e=Fireside.logic.misc.store.get("offlineLog")||[],f=[a,b];c&&f.push(c),e.unshift(f),e.length>0&&(e=e.slice(0,d)),Fireside.logic.misc.store.set("offlineLog",e)},offLogRestore:function(){var a=Fireside.logic.misc.store.get("offlineLog");a.reverse();for(var c in a){var d=a[c],e=d[0]||" ",f=d[1]||" ",g=b.logMsg(e,f).el;d[2]&&g.addClass("error")}},_newSentence:function(){return this.DOM.sentence_template.clone()},userStatus:function(a){this.DOM["status-icon"].attr("class","icon "+a)},trim:function(a){a=a.replace(/^\s+/,"");for(var b=a.length-1;b>=0;b--)if(/\S/.test(a.charAt(b))){a=a.substring(0,b+1);break}return a},offline:function(){return!0},logMsg:function(a,c){if("object"==typeof c){c.error;var c=c.msg}"undefined"==typeof store&&(store=!0);var d=b._newSentence();if(c=b.trim(c),0==c.length)return!1;var e=d.find('[data-attr="words"]'),f=e.text(c).html().replace(/\n/g,"<br/>");e.html(f),d.find('[data-attr="sender"]').html(a+":");var g=this.isScrollBottom();this.DOM.log.append(d),g&&(b.DOM.log[0].scrollTop=b.DOM.log[0].scrollHeight);var h={el:d,log:function(d){var e=!!d;b.offLogSet(a,c,e)}};return h}};return b}(jQuery),Fireside.init=function(a){Fireside.ui.init(a),Fireside.logic.init(a)},Fireside.css='.chat-box-title div.icon{background-image:url("data:image/png;base64,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")}.menu-button:hover{color:#FFF;cursor:pointer}.menu-button{font-weight:700;color:#24F;position:absolute;top:0;right:10px;float:left}.cwm-menu-container button{width:90%;line-height:20px;margin:10px}.cwm-menu-container ul{margin:0;padding:0;list-style:none}.cwm-menu-container{display:none;position:absolute;background:#FFF;font-size:14px;text-align:center;line-height:24px;width:100%;height:100%;opacity:.8}.nickname .container{margin-top:50px}.nickname label{display:block;width:100%;padding-bottom:5px;text-align:center}.chat-box .nickname{text-align:center;position:absolute;background:#FFF;width:100%;height:100%}div.chat-box.minimize{height:20px}.chat-box-title.lightup{background-color:#8EF}.chat-box-title{width:100%;cursor:pointer;line-height:20px;background:#4AD;vertical-align:middle}.chat-box-title:hover{background:#6CF}.chat-box-title .icon{float:left}.chat-box-title .caption{font-weight:700;color:#fff}.chat-box{border-top-left-radius:5px;border-top-right-radius:5px;font:400 normal 11px/1.4 Tahoma,Verdana,Sans-Serif;color:#333;width:100px;border:1px solid #344150;border-bottom:0;background-color:#fff;position:fixed;right:10px;bottom:0;z-index:9999;-webkit-box-shadow:1px 1px 5px rgba(0,0,0,.2);-moz-box-shadow:1px 1px 5px rgba(0,0,0,.2);box-shadow:1px 1px 5px rgba(0,0,0,.2)}.chat-box .sender{font-weight:700;padding-right:5px}.sentence span{display:inline}.sentence{word-wrap:break-word}div.convo{height:150px;padding:0 10px 5px;overflow-y:scroll}.chat-box{width:200px;border:1px solid #CCC;font:400 normal 11px/1.4 Tahoma,Verdana,Sans-Serif}div.convo .sentence.error{color:#AAA;font-style:italic}.chat-box textarea{width:178px;padding:5px;margin-left:5px;height:50px;margin-bottom:5px;resize:none}.chat-box-content .info{border-top:1px dashed #CCC;color:#AAA;padding:5px}div.chat-box.full-window{height:auto;width:auto;top:0;left:0}.full-window div.chat-box-content{height:100%}.full-window div.keyboard{height:90%;width:100%}.full-window textarea{height:100px;width:100%;padding:0;margin:0;bottom:0}.full-window div.convo{padding:0;height:50%}.icon.away{background-image:url(icon.png);background-position:0 -13px;width:16px;height:16px}.icon.busy{background-image:url(icon.png);background-position:0 -29px;width:16px;height:16px}.icon.connecting{background-image:url(icon.png);background-position:0 -45px;width:16px;height:16px}.icon.error{background-image:url(icon.png);background-position:0 0;width:16px;height:13px}.icon.loading{background-image:url(icon.png);background-position:0 -61px;width:16px;height:16px}.icon.offline{background-image:url(icon.png);background-position:0 -77px;width:16px;height:16px}.icon.online{background-image:url(icon.png);background-position:0 -93px;width:16px;height:16px}.icon.spritesheet{background-image:url(icon.png);background-position:0 -109px;width:1px;height:16px}',Fireside.template='<div class="chat-box minimize"  data-container="chatbox">  <div class="chat-box-title" data-attr="chatbox-title">\n    <div data-attr="status-icon" class="status-icon icon offline"></div>\n    <div class="caption" data-attr="titlebar">Chat With&nbsp;</div>  </div>  <div class="chat-box-content">\n    <div class="cwm-menu" data-attr="cwm-menu">\n      <div class="menu-button">[+]</div>\n      <div class="cwm-menu-container" data-attr="cwm-menu">\n\n        <ul>\n\n          <li><button data-action="clear">Clear Log</button></li>\n\n          <li><button data-action="disconnect">Disconnect</button></li>\n\n          <li><button data-action="disable">Disable</button></li> <li><button data-action="none">Cancel</button></li>\n        </ul>\n      </div>\n    </div>\n    <div class="nickname" data-attr="nickname-box">\n      <div class="container">\n\n        <div>\n\n          <label for="nickname">Hello! What is your name?</label>\n\n          <input data-attr="nickname" type="text" name="nickname"></input>\n\n        </div>\n      </div>\n    </div>\n    <div data-attr="log" class="convo">\n      <div class="sentence" data-attr="sentence">\n\n        <span class="icon" data-attr="icon"></span><span data-attr="sender" class="sender">SENDER:</span>\n\n        <span data-attr="words" class="words">MSG</span>\n      </div>\n    </div>\n    <div class="keyboard">\n      <div data-attr="info" class="info" style="display:none">Info...</div>\n      <textarea data-attr="textarea"></textarea>  </div></div>\n  <div>\n';
